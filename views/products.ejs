<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Sản phẩm</title>
    <meta name="description" content="Jetson is a Dashboard & Admin Site Responsive Template by hencework." />
    <meta name="keywords"
        content="admin, admin dashboard, admin template, cms, crm, Jetson Admin, Jetsonadmin, premium admin templates, responsive admin, sass, panel, software, ui, visualization, web app, application" />
    <meta name="author" content="hencework" />
    <!-- Favicon -->
    <link rel="shortcut icon" href="../public/favicon.ico">
    <link rel="stylesheet" href="../public/themify-icons/themify-icons.css">
    <link rel="icon" href="../public/favicon.ico" type="image/x-icon">
    <!-- vector map CSS -->
    <link href="../public/vendors/vectormap/jquery-jvectormap-2.0.2.css" rel="stylesheet" type="text/css" />

    <!-- Footable CSS -->
    <link href="../public/vendors/bower_components/FooTable/compiled/footable.bootstrap.min.css" rel="stylesheet"
        type="text/css" />
    <!-- Custom CSS -->
    <link href="../public/dist/css/style.css" rel="stylesheet" type="text/css">

    <link href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css">

    <style>
        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        #btn_add_category {
            margin-top: 20px;
            width: 50px;
            height: 50px;
        }

        #category-add {
            width: 100px;
            height: 100px;
        }
    </style>
</head>

<body>
    <!--Preloader-->
    <div class="preloader-it">
        <div class="la-anim-1"></div>
    </div>
    <!--/Preloader-->
    <div class="wrapper theme-1-active pimary-color-green">
        <%-include("./block/user-header")%>
            <%-include("./block/user-nav")%>
        <!-- Top Menu Items -->
        <!-- /Top Menu Items -->

        <!-- Left Sidebar Menu -->

        <!-- /Left Sidebar Menu -->

        <!-- Right Sidebar Menu -->

        <!-- /Right Sidebar Menu -->



        <!-- Main Content -->
        <div class="page-wrapper">
            <div class="container-fluid">
                <!-- Title -->
                <div class="row heading-bg">
                    <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                        <h5 class="txt-dark">Danh sách sản phẩm</h5>
                    </div>
                    <!-- Breadcrumb -->
                    <!-- /Breadcrumb -->
                </div>
                <!-- /Title -->

                <!-- MODAL -->

                <!-- Modal Thêm (Dựa mẫu Views Category) -->
                <form action="products/create" enctype="multipart/form-data" method="post">
                    <div id="modal_add_products" class="modal">
                        <div class="modal-content">
                            <div class="panel panel-default card-view">
                                <div class="panel-wrapper collapse in">
                                    <div class="panel-body">
                                        <div class="form-wrap">
                                            <form action="#">
                                                <h6 class="txt-dark capitalize-font"><i
                                                        class="zmdi zmdi-info-outline mr-10"></i>Thêm Sản Phẩm</h6>
                                                <hr class="light-grey-hr">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <!-- ID -->
                                                            <label class="control-label mb-10">Tên Sản Phẩm</label>
                                                            <input name="tensp" type="text" id="firstName"
                                                                class="form-control" placeholder="VD: Apple Iphone">
                                                        </div>
                                                    </div>
                                                    <!--/span-->
                                                    <!--/span-->
                                                </div>
                                                <!-- Row -->
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group" >
                                                            <label class="control-label mb-10">Danh Mục</label>
                                                            <select class="form-control" data-placeholder="Chọn Danh Mục"  name="danhmuc" tabindex="1">
                                                                <%categories.forEach(item=> {%>
																<option value="<%=item.category_id%>"> <%=item.category_name%></option>
																
                                                                <%})%>
															</select>

                                                           
                                                                <!-- <label style="display: inline-block;">
                                                                    
                                                                </label>
                                                                <input class="form-control" type="checkbox"
                                                                    name="danhmuc" value="" style="width: 20px;"> -->
                                                                   
                                                        </div>
                                                    </div>
                                                    <!--/span-->
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label mb-10">Tình Trạng</label>
                                                            <div class="radio-list">
                                                                <div class="radio-inline pl-0">
                                                                    <div class="radio radio-info">
                                                                        <input type="radio" name="tinhtrang" id="radio1"
                                                                            value="0">
                                                                        <label for="radio1">Ẩn</label>
                                                                    </div>
                                                                </div>
                                                                <div class="radio-inline">
                                                                    <div class="radio radio-info">
                                                                        <input type="radio" name="tinhtrang" id="radio2"
                                                                            value="1" checked>
                                                                        <label for="radio2">Hiện</label>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--/span-->
                                                </div>
                                                <!--/row-->
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label class="control-label mb-10">Giá tiền</label>
                                                            <div class="input-group">
                                                                <div class="input-group-addon"><i class="ti-money"></i>
                                                                </div>
                                                                <input type="number" class="form-control" name="price"
                                                                    id="exampleInputuname" placeholder="0 VNĐ" required>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!--/span-->
                                                    <!--/span-->
                                                </div>
                                                <div class="seprator-block"></div>
                                                <h6 class="txt-dark capitalize-font"><i
                                                        class="zmdi zmdi-comment-text mr-10"></i>Nội Dung</h6>
                                                <hr class="light-grey-hr">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <textarea name="content" class="form-control" rows="6"
                                                                placeholder="mô tả sản phẩm...." required></textarea>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="seprator-block"></div>
                                                <!--/row-->
                                                <h6 class="txt-dark capitalize-font"><i
                                                        class="zmdi zmdi-collection-image mr-10"></i>Tải Ảnh</h6>
                                                <hr class="light-grey-hr">
                                                <div class="row">
                                                    <div class="col-lg-12">
                                                        <div class="img-upload-wrap">
                                                            <img class="img-responsive" src="public/dist/img/chair.jpg"
                                                                alt="upload_img">
                                                        </div>
                                                        <div class="fileupload btn btn-info btn-anim"><i
                                                                class="fa fa-upload"></i><span class="btn-text">Tải
                                                                Ảnh</span>
                                                            <input type="file" name="file" class="upload" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="seprator-block"></div>
                                                <div class="form-actions">
                                                    <button class="btn btn-success btn-icon left-icon mr-10 pull-left">
                                                        <i class="fa fa-check"></i> <span>Lưu</span></button>
                                                    <button type="button" id="btn_huybo"
                                                        class="btn btn-warning pull-left">Huỷ bỏ</button>
                                                    <div class="clearfix"></div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Modal Xoá (Dựa mẫu Views Category) -->
                <form action="../products/delete" method="post">
                    <div id="modal_delete" class="modal-content modal" style="width: 400px; height: 170px;">
                        <span class="close">&times;</span>
                        <div class="modal-header">
                            <h5 class="modal-title" id="mySmallModalLabel">Bạn có chắc chắn muốn xoá ?</h5>
                        </div>
                        <input type="hidden" name="id" value="" id="idProduct">
                        <div class="modal-body mt-5">
                            <button class="mr-10 ml-5" style="font-weight: bold;"><i class="ti-check"
                                    style="font-weight: bold;"></i> Chắc chắn</button>
                            <button id="btn_noDelete" type="button" style="font-weight: bold;"><i class="ti-close"
                                    style="font-weight: bolder;"></i> Không</button>
                        </div>
                    </div>
                </form>


                <!-- Modal Sửa -->
                <!-- <form action="../categories/update" method="post">
                    <div id="modal_edit" class="modal">
                        <div class="modal-content">
                            <div class="form-body overflow-hide">
                                <div class="input-group">
                                    <input type="hidden" name="id" value="" id="idEdit">
                                    <input type="text" id="example-input2-group2" name="edit_name" class="form-control"
                                        placeholder="Tên Danh Mục">
                                    <span class="input-group-btn">
                                        <button class="btn btn-success btn-anim"><i class="icon-rocket"></i><span
                                                class="btn-text">Sửa</span></button>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form> -->

                <!-- Modal hiện thông tin và sửa sản phẩm -->
                <form action="" method="post">
                    <div class="modal" id="modal_show">
                        <div class="modal-content">
                            <span class="close">&times;</span>
                            <div class="panel-wrapper collapse in ">
                                <div class="panel-body">
                                    <input type="hidden" name="idProduct" id="idProductEdit" value="" >
                                    <div class="row" id="show_product">
                                        <!-- Code sẽ ở trong này -->    
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </form>
                <!-- Row -->
                <div class="row">
                    <div class="col-sm-12">
                        <div class="panel panel-default card-view">
                            <div class="panel-heading">
                                <div class="pull-left">
                                    <h6 class="panel-title txt-dark">Sản phẩm</h6>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                            <!-- Button AddCategory -->
                            <div id="btn_add_category">
                                <Button id="add_products" style="display: block; width: 100px; height: 50px;"><i
                                        class="ti-plus" style="font-weight: bold;"></i></Button>
                            </div>
                            <div class="panel-wrapper collapse in">
                                <div class="panel-body pa-0">
                                    <div class="table-wrap">
                                        <table id="footable_1" class="table">
                                            <thead>
                                                <tr>
                                                    <th>STT</th>
                                                    <th>Tên Sản Phẩm</th>
                                                    <th>Giá</th>
                                                    <th>Trạng thái</th>
                                                    <th>Ngày Tạo</th>
                                                    <th>Ngày Sửa</th>
                                                    <th>Hành động</th>
                                                </tr>
                                            </thead>
                                            <!-- Đổ dữ liệu Category -->
                                            <tbody>
                                                <%var i=0; products.forEach(item=>{%>
                                                    <tr>
                                                        <td>
                                                            <%=++i%>
                                                        </td>
                                                        <td>
                                                            <%=item.product_name%>
                                                        </td>
                                                        <td>
                                                            <%=item.price%>
                                                        </td>
                                                        <td>
                                                            <%if(item.status == 1){%>
                                                            <p style="color: green;">Đang bán</p>
                                                            <%}else{%>
                                                            <p style="color: red;">Hết hàng</p>
                                                            <%}%>
                                                        </td>
                                                        <td>
                                                            <%var date=new Date(item.created_at); var
                                                                created_at=date.getDate() + '/' + (date.getMonth()+1) + '/'
                                                                + date.getFullYear(); %>
                                                                <%=created_at%>
                                                        </td>

                                                        <td>
                                                            <%var date=new Date(item.updated_at); var
                                                                updated_at=date.getDate() + '/' + (date.getMonth()+1) + '/'
                                                                + date.getFullYear(); %>
                                                                <%=updated_at%>
                                                        </td>
                                                        <td>
                                                            <button class="btn_show mr-5"
                                                                style="width: 40px; height: 40px;" onmouseup="loadTable(<%=item.product_id%>)">
                                                                <i class="ti-eye" style="font-weight: bold;"></i>
                                                            </button>
                                                            <button class="btn_delete mr-5"
                                                                style="width: 40px; height: 40px;"
                                                                onmouseup="setId(<%=item.product_id%>)">
                                                                <i class="ti-trash" style="font-weight: bold;"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <%})%>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Row -->

                <!-- /Row -->

                <!-- Footer -->
                <footer class="footer container-fluid pl-30 pr-30">
                    <div class="row">
                        <div class="col-sm-12">
                            <p>2023 &copy; Thesis by The Anh Phung with Thuy Trang Phung</p>
                        </div>
                    </div>
                </footer>
                <!-- /Footer -->

            </div>
        </div>
        <!-- /Main Content -->

    </div>
    <div class="abc" id="abc">

    </div>
    <!-- /#wrapper -->

    <!-- JavaScript -->
    <script>
        //Lấy ID (Dựa mẫu Views Category)
        var idProduct = "";
        function setId(id) {
            idProduct = id;
            document.getElementById("idProduct").value = idProduct;
        }

        //Xoá Sản Phẩm (Dựa mẫu Views Category)
        var modal_delete = document.getElementById("modal_delete");
        for (let i = 0; i < <%= products.length %>; i++) {
            var btn_deleteProduct = document.getElementsByClassName("btn_delete")[i];
            btn_deleteProduct.onclick = function () {
                modal_delete.style.display = "block";
            }
        }
        var close1 = document.getElementsByClassName("close")[0];
        close1.onclick = function () {
            modal_delete.style.display = "none";
        }
        var btn_noDelete = document.getElementById("btn_noDelete");
        btn_noDelete.onclick = function () {
            modal_delete.style.display = "none";
        }

        var close2 = document.getElementsByClassName("close")[1];
        close2.onclick = function () {
            modal_show.style.display = "none";
        }

        //Modal Thêm Sản Phẩm (Dựa mẫu Views Category)
        var btn_addProducts = document.getElementById("add_products");
        var modal_add_products = document.getElementById("modal_add_products");
        btn_addProducts.onclick = function () {
            modal_add_products.style.display = "block";
        }
        var btn_huy = document.getElementById("btn_huybo");
        btn_huy.onclick = function () {
            modal_add_products.style.display = "none";
        }

        //Modal Show Sửa sản phẩm
        var modal_show = document.getElementById("modal_show");
        for (let i = 0; i < <%= products.length %>; i++) {
            var btn_show = document.getElementsByClassName("btn_show")[i];
            btn_show.onclick = function () {
                modal_show.style.display = "block";
            }
        }


        //Envent click ra ngoài window khi mở Modal Sửa và Thêm sẽ đóng Modal
        window.onclick = function (event) {
            if (event.target == modal_add_products || event.target == modal_show) {
                modal_add_products.style.display = "none";
                modal_show.style.display = "none";
            }
        }

    </script>

    <!-- jQuery -->
    <script src="../public/vendors/bower_components/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../public/vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <!-- Data table JavaScript -->
    <script src="../public/vendors/bower_components/moment/min/moment.min.js"></script>
    <script src="../public/vendors/bower_components/FooTable/compiled/footable.min.js" type="text/javascript"></script>
    <script src="../public/dist/js/footable-data.js"></script>

    <!-- Slimscroll JavaScript -->
    <script src="../public/dist/js/jquery.slimscroll.js"></script>

    <!-- Fancy Dropdown JS -->
    <script src="../public/dist/js/dropdown-bootstrap-extended.js"></script>

    <!-- Owl JavaScript -->
    <script src="../public/vendors/bower_components/owl.carousel/dist/owl.carousel.min.js"></script>

    <!-- Switchery JavaScript -->
    <script src="../public/vendors/bower_components/switchery/dist/switchery.min.js"></script>

    <!-- Init JavaScript -->
    <script src="../public/dist/js/init.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
    <!-- Tiếng Việt cho Datatable -->
    <script type="text/javascript" src="https://cdn.datatables.net/plug-ins/1.10.25/i18n/Vietnamese.json"></script>

    <script>
        $(document).ready(function () {
            $('#footable_1').DataTable({
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.10.25/i18n/Vietnamese.json"
                }
            });
        });
    
        function loadTable(id) {
            document.getElementById("idProductEdit").value = id;
            $.get("/products/show/" + id, (data) => {
                console.log(data);
                let html = ``   
                data.forEach(item => {
                    html += `<div class="col-md-3">
                                            <div class="item-big">
                                                <!-- START carousel-->
                                                <div id="carousel-example-captions-1" data-ride="carousel"
                                                    class="carousel slide">
                                                    <ol class="carousel-indicators">
                                                        <li data-target="#carousel-example-captions-1" data-slide-to="0"
                                                            class=""></li>
                                                        <li data-target="#carousel-example-captions-1" data-slide-to="1"
                                                            class="active"></li>
                                                    </ol>
                                                    <div role="listbox" class="carousel-inner">
                                                        <div class="item active left"> <img style="height: 373px;"
                                                                src="public/upload/${item.file_name}"
                                                                alt="First slide image"> </div>
                                                        <div class="item next left"> <img style="height: 373px;"
                                                                src="public/upload/${item.file_name}"
                                                                alt="Second slide image"> </div>
                                                    </div>
                                                </div>
                                                <!-- END carousel-->
                                            </div>
                                        </div>
                                        <div class="col-md-9">
                                            <div class="product-detail-wrap">
                                                <h3 class="mb-10 weight-500">
                                                    ${item.product_name}
                                                </h3>
                                                <div class="product-price head-font mb-20">
                                                    <input style="width: 140px;" type="number" name="edit_price"
                                                        value="${item.price}"> VNĐ
                                                </div>`
                                                if(item.status == 1) {
                                                    html += `
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label mb-10">Tình Trạng</label>
                                                        <div class="radio-list">
                                                            <div class="radio-inline pl-0">
                                                                <div class="radio radio-info">
                                                                    <input type="radio" name="edit_tinhtrang" id="radio1"
                                                                        value="0">
                                                                    <label for="radio1">Ẩn</label>
                                                                </div>
                                                            </div>
                                                            <div class="radio-inline">
                                                                <div class="radio radio-info">
                                                                    <input type="radio" checked="true" name="edit_tinhtrang" id="radio2"
                                                                        value="1">
                                                                    <label for="radio2">Hiện</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <textarea name="edit_content" class="form-control mb-20"
                                                    style="width: 700px; height: 129px;">${item.contents}</textarea>
                                                <div class="btn-group wishlist">
                                                    <button class="btn btn-warning btn-outline btn-anim"><i
                                                            class="icon-heart"></i><span
                                                            class="btn-text">Sửa</span></button>
                                                </div>
                                            </div>
                                        </div>`
                                                }
                                                else {
                                                    html +=`
                                                <div class="col-md-6">
                                                    <div class="form-group">
                                                        <label class="control-label mb-10">Tình Trạng</label>
                                                        <div class="radio-list">
                                                            <div class="radio-inline pl-0">
                                                                <div class="radio radio-info">
                                                                    <input type="radio" checked="True" name="edit_tinhtrang" id="radio1"
                                                                        value="0">
                                                                    <label for="radio1">Ẩn</label>
                                                                </div>
                                                            </div>
                                                            <div class="radio-inline">
                                                                <div class="radio radio-info">
                                                                    <input type="radio" name="edit_tinhtrang" id="radio2"
                                                                        value="1">
                                                                    <label for="radio2">Hiện</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <textarea name="edit_content" class="form-control mb-20"
                                                    style="width: 700px; height: 129px;">${item.contents}</textarea>
                                                <div class="btn-group wishlist">
                                                    <button class="btn btn-warning btn-outline btn-anim"><i
                                                            class="icon-heart"></i><span
                                                            class="btn-text">Sửa</span></button>
                                                </div>
                                            </div>
                                        </div>`
                                                }
                                                
                                                
                });
                $("#show_product").html(html);
            })
        }

    </script>
</body>

</html>